<script>
// VÃ¤nta tills alla HTML-element Ã¤r laddade
document.addEventListener('DOMContentLoaded', function() {
    
    let gameweekResults = {
        1: { 
            lastPlace: 'Samuel Rosqvist', 
            points: { 
                'August BÃ¥ng': 54, 'Emil JÃ¶nsson': 46, 'Elias HÃ¥kansson': 49, 'Oscar Jonsson': 57, 'Samuel Rosqvist': 42, 
                'Anton StrÃ¶m': 62, 'Sebastian Bonasoni': 66, 'Fredrik LillbÃ¤ck': 46, 'Jakob HammarstrÃ¶m': 58 
            }
        },
        2: { 
            lastPlace: 'August BÃ¥ng', 
            points: { 
                'August BÃ¥ng': 36, 'Emil JÃ¶nsson': 44, 'Elias HÃ¥kansson': 48, 'Oscar Jonsson': 38, 'Samuel Rosqvist': 48, 
                'Anton StrÃ¶m': 60, 'Sebastian Bonasoni': 49, 'Fredrik LillbÃ¤ck': 72, 'Jakob HammarstrÃ¶m': 39 
            }
        },
        3: { 
            lastPlace: 'Emil JÃ¶nsson', 
            points: { 
                'August BÃ¥ng': 67, 'Emil JÃ¶nsson': 24, 'Elias HÃ¥kansson': 48, 'Oscar Jonsson': 52, 'Samuel Rosqvist': 55, 
                'Anton StrÃ¶m': 46, 'Sebastian Bonasoni': 44, 'Fredrik LillbÃ¤ck': 42, 'Jakob HammarstrÃ¶m': 45 
            }
        },
        4: { 
            lastPlace: 'Elias HÃ¥kansson', 
            points: { 
                'August BÃ¥ng': 63, 'Emil JÃ¶nsson': 91, 'Elias HÃ¥kansson': 59, 'Oscar Jonsson': 76, 'Samuel Rosqvist': 64, 
                'Anton StrÃ¶m': 70, 'Sebastian Bonasoni': 77, 'Fredrik LillbÃ¤ck': 81, 'Jakob HammarstrÃ¶m': 73 
            }
        }
    };

    const players = [
        'Fredrik LillbÃ¤ck', 'Anton StrÃ¶m', 'Sebastian Bonasoni', 'Oscar Jonsson', 'August BÃ¥ng', 
        'Samuel Rosqvist', 'Jakob HammarstrÃ¶m', 'Emil JÃ¶nsson', 'Elias HÃ¥kansson'
    ];

    function calculateSwishStats() {
        const swishCount = {};
        players.forEach(player => swishCount[player] = 0);
        
        Object.values(gameweekResults).forEach(gw => {
            if (gw.lastPlace) {
                swishCount[gw.lastPlace]++;
            }
        });
        
        return swishCount;
    }

    function updateLeaderboard() {
        const swishStats = calculateSwishStats();
        const sortedPlayers = players.sort((a, b) => swishStats[b] - swishStats[a]);
        
        const leaderboardEl = document.getElementById('leaderboard');
        if (!leaderboardEl) return;
        
        leaderboardEl.innerHTML = '';
        
        sortedPlayers.forEach((player, index) => {
            const swishAmount = swishStats[player] * 30;
            const item = document.createElement('div');
            item.className = `leaderboard-item ${index === 0 && swishAmount > 0 ? 'top-payer' : ''}`;
            
            item.innerHTML = `
                <div class="player-info">
                    <div class="position">${index + 1}</div>
                    <span>${player}</span>
                </div>
                <div class="swish-amount">${swishAmount} kr</div>
            `;
            
            leaderboardEl.appendChild(item);
        });
    }

    function updateHistoryTable() {
        const tbody = document.getElementById('historyTableBody');
        if (!tbody) return;
        
        tbody.innerHTML = '';
        
        const swishStats = calculateSwishStats();
        
        players.forEach(player => {
            const row = document.createElement('tr');
            const totalSwish = swishStats[player] * 30;
            
            let rowHTML = `<td class="player-name">${player}</td>`;
            
            for (let gw = 1; gw <= 4; gw++) {
                const points = gameweekResults[gw]?.points[player] || '-';
                const isLast = gameweekResults[gw]?.lastPlace === player;
                rowHTML += `<td class="${isLast ? 'last-place' : 'points'}">${points}${isLast ? ' ðŸ’¸' : ''}</td>`;
            }
            
            rowHTML += `<td class="swish-amount"><strong>${totalSwish} kr</strong></td>`;
            row.innerHTML = rowHTML;
            tbody.appendChild(row);
        });
    }

    function updateSummaryStats() {
        const completedRounds = Object.keys(gameweekResults).length;
        const totalSwish = completedRounds * 30;
        const remainingRounds = 38 - completedRounds;
        
        const totalEl = document.getElementById('totalSwish');
        const completedEl = document.getElementById('completedRounds');
        const remainingEl = document.getElementById('remainingRounds');
        
        if (totalEl) totalEl.textContent = totalSwish;
        if (completedEl) completedEl.textContent = completedRounds;
        if (remainingEl) remainingEl.textContent = remainingRounds;
    }

    function populatePlayerDropdown() {
        const select = document.getElementById('lastPlace');
        if (!select) return;
        
        select.innerHTML = '<option value="">VÃ¤lj spelare...</option>';
        players.forEach(player => {
            const option = document.createElement('option');
            option.value = player;
            option.textContent = player;
            select.appendChild(option);
        });
    }

    function updateAll() {
        updateLeaderboard();
        updateHistoryTable();
        updateSummaryStats();
        populatePlayerDropdown();
    }

    // Uppdatera status
    const statusEl = document.getElementById('apiStatus');
    if (statusEl) {
        statusEl.innerHTML = 'âœ… Visar data med riktiga spelnamn frÃ¥n er FPL-liga!';
    }

    // KÃ¶r alla uppdateringar
    updateAll();

    // LÃ¤gg till event handlers
    window.addResult = function() {
        const gameweek = document.getElementById('gameweek').value;
        const lastPlace = document.getElementById('lastPlace').value;
        
        if (!lastPlace) {
            alert('VÃ¤lj vilken spelare som kom sist!');
            return;
        }
        
        gameweekResults[parseInt(gameweek)] = {
            lastPlace: lastPlace,
            points: {}
        };
        
        updateAll();
        alert(`Gameweek ${gameweek} tillagd! ${lastPlace} swishar 30 kr.`);
        
        document.getElementById('lastPlace').value = '';
    };

    window.saveLeagueId = function() {
        alert('Liga-ID Ã¤r redan konfigurerat!');
    };

    window.refreshData = function() {
        location.reload();
    };
});
</script>
