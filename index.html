<script>
// H√§mta automatiskt FPL-data fr√•n JSON-fil
let gameweekResults = {};
let players = [];

// Ladda FPL-data automatiskt
async function loadFPLData() {
    try {
        const response = await fetch('fpl-data.json');
        const data = await response.json();
        
        // Uppdatera spelarlista baserat p√• riktiga namn
        players = data.standings.results.map(player => player.player_name);
        
        // Ber√§kna swish baserat p√• senaste gameweek (vem som kom sist)
        const currentRank = data.standings.results.sort((a, b) => b.rank - a.rank);
        const lastPlace = currentRank[currentRank.length - 1].player_name;
        
        // Historisk data - beh√•ll din manuella data f√∂r GW 1-4
        gameweekResults = {
            1: { 
                lastPlace: 'Samuel', 
                points: { 
                    'August B√•ng': 54, 'Emil J√∂nsson': 46, 'Elias H√•kansson': 49, 'Oscar Jonsson': 57, 'Samuel Rosqvist': 42, 
                    'Anton Str√∂m': 62, 'Sebastian Bonasoni': 66, 'Fredrik Lillb√§ck': 46, 'Jakob Hammarstr√∂m': 58 
                }
            },
            2: { 
                lastPlace: 'August B√•ng', 
                points: { 
                    'August B√•ng': 36, 'Emil J√∂nsson': 44, 'Elias H√•kansson': 48, 'Oscar Jonsson': 38, 'Samuel Rosqvist': 48, 
                    'Anton Str√∂m': 60, 'Sebastian Bonasoni': 49, 'Fredrik Lillb√§ck': 72, 'Jakob Hammarstr√∂m': 39 
                }
            },
            3: { 
                lastPlace: 'Emil J√∂nsson', 
                points: { 
                    'August B√•ng': 67, 'Emil J√∂nsson': 24, 'Elias H√•kansson': 48, 'Oscar Jonsson': 52, 'Samuel Rosqvist': 55, 
                    'Anton Str√∂m': 46, 'Sebastian Bonasoni': 44, 'Fredrik Lillb√§ck': 42, 'Jakob Hammarstr√∂m': 45 
                }
            },
            4: { 
                lastPlace: 'Elias H√•kansson', 
                points: { 
                    'August B√•ng': 63, 'Emil J√∂nsson': 91, 'Elias H√•kansson': 59, 'Oscar Jonsson': 76, 'Samuel Rosqvist': 64, 
                    'Anton Str√∂m': 70, 'Sebastian Bonasoni': 77, 'Fredrik Lillb√§ck': 81, 'Jakob Hammarstr√∂m': 73 
                }
            }
        };
        
        updateAll();
        document.getElementById('apiStatus').innerHTML = `‚úÖ Data automatiskt uppdaterad fr√•n Liga ${data.league.id} - Senast: ${new Date(data.last_updated_data).toLocaleString('sv-SE')}`;
        
    } catch (error) {
        console.error('Kunde inte ladda FPL-data:', error);
        document.getElementById('apiStatus').innerHTML = '‚ùå Kunde inte h√§mta automatisk data - anv√§nder manuell data';
        
        // Fallback till gamla namn om API misslyckas
        players = [
            'August', 'The Big Nerd', 'Elias', 'Oscar', 'Samuel', 
            'Anton', 'Sebastian', 'Fredrik', 'Jakob'
        ];
        updateAll();
    }
}

// Resten av funktionerna (beh√•ll som de var)
function calculateSwishStats() {
    const swishCount = {};
    players.forEach(player => swishCount[player] = 0);
    
    Object.values(gameweekResults).forEach(gw => {
        if (gw.lastPlace) {
            swishCount[gw.lastPlace]++;
        }
    });
    
    return swishCount;
}

function updateLeaderboard() {
    const swishStats = calculateSwishStats();
    const sortedPlayers = players.sort((a, b) => swishStats[b] - swishStats[a]);
    
    const leaderboardEl = document.getElementById('leaderboard');
    leaderboardEl.innerHTML = '';
    
    sortedPlayers.forEach((player, index) => {
        const swishAmount = swishStats[player] * 30;
        const item = document.createElement('div');
        item.className = `leaderboard-item ${index === 0 && swishAmount > 0 ? 'top-payer' : ''}`;
        
        item.innerHTML = `
            <div class="player-info">
                <div class="position">${index + 1}</div>
                <span>${player}</span>
            </div>
            <div class="swish-amount">${swishAmount} kr</div>
        `;
        
        leaderboardEl.appendChild(item);
    });
}

function updateHistoryTable() {
    const tbody = document.getElementById('historyTableBody');
    tbody.innerHTML = '';
    
    const swishStats = calculateSwishStats();
    
    players.forEach(player => {
        const row = document.createElement('tr');
        const totalSwish = swishStats[player] * 30;
        
        let rowHTML = `<td class="player-name">${player}</td>`;
        
        for (let gw = 1; gw <= 4; gw++) {
            const points = gameweekResults[gw]?.points[player] || '-';
            const isLast = gameweekResults[gw]?.lastPlace === player;
            rowHTML += `<td class="${isLast ? 'last-place' : 'points'}">${points}${isLast ? ' üí∏' : ''}</td>`;
        }
        
        rowHTML += `<td class="swish-amount"><strong>${totalSwish} kr</strong></td>`;
        row.innerHTML = rowHTML;
        tbody.appendChild(row);
    });
}

function updateSummaryStats() {
    const completedRounds = Object.keys(gameweekResults).length;
    const totalSwish = completedRounds * 30;
    const remainingRounds = 38 - completedRounds;
    
    document.getElementById('totalSwish').textContent = totalSwish;
    document.getElementById('completedRounds').textContent = completedRounds;
    document.getElementById('remainingRounds').textContent = remainingRounds;
}

function populatePlayerDropdown() {
    const select = document.getElementById('lastPlace');
    select.innerHTML = '<option value="">V√§lj spelare...</option>';
    players.forEach(player => {
        const option = document.createElement('option');
        option.value = player;
        option.textContent = player;
        select.appendChild(option);
    });
}

function addResult() {
    const gameweek = document.getElementById('gameweek').value;
    const lastPlace = document.getElementById('lastPlace').value;
    
    if (!lastPlace) {
        alert('V√§lj vilken spelare som kom sist!');
        return;
    }
    
    gameweekResults[parseInt(gameweek)] = {
        lastPlace: lastPlace,
        points: {}
    };
    
    updateAll();
    alert(`Gameweek ${gameweek} tillagd! ${lastPlace} swishar 30 kr.`);
    
    document.getElementById('lastPlace').value = '';
}

function updateAll() {
    updateLeaderboard();
    updateHistoryTable();
    updateSummaryStats();
    populatePlayerDropdown();
}

function saveLeagueId() {
    alert('Liga-ID √§r redan konfigurerat f√∂r automatisk datah√§mtning!');
}

function refreshData() {
    location.reload();
}

// Initiera sidan med automatisk datah√§mtning
document.addEventListener('DOMContentLoaded', function() {
    loadFPLData();
});
</script>
